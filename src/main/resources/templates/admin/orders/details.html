<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/admin-layout :: html(content=~{::main})}">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</title>
</head>
<body>
<main>
    <div class="order-detail-container">

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="order-header-minimal">
            <div>
                <h1>–ó–∞–∫–∞–∑ #[[${order.id}]]</h1>
                <div class="order-date" th:text="${#temporals.format(order.createdAt, 'dd MMMM yyyy, HH:mm')}">
                    27 —Ñ–µ–≤—Ä–∞–ª—è 2026, 15:30
                </div>
            </div>
            <div class="order-status-minimal">
                <span th:text="${order.status.name() == 'PENDING' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' :
                              order.status.name() == 'CONFIRMED' ? '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' :
                              order.status.name() == 'PREPARING' ? 'üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∏—Ç—Å—è' :
                              order.status.name() == 'READY_FOR_DELIVERY' ? 'üì¶ –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ' :
                              order.status.name() == 'ON_THE_WAY' ? 'üöö –í –ø—É—Ç–∏' :
                              order.status.name() == 'DELIVERED' ? '‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω' :
                              order.status.name() == 'COMPLETED' ? '‚ú® –ó–∞–≤–µ—Ä—à–µ–Ω' :
                              order.status.name() == 'CANCELLED' ? '‚ùå –û—Ç–º–µ–Ω–µ–Ω' : ''}">
                </span>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="info-grid-minimal">
            <!-- –ö–ª–∏–µ–Ω—Ç -->
            <div class="info-card-minimal">
                <h3>üë§ –ö–ª–∏–µ–Ω—Ç</h3>
                <div class="info-row-minimal">
                    <span class="label">–ò–º—è:</span>
                    <span class="value" th:text="${order.customerName}">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</span>
                </div>
                <div class="info-row-minimal">
                    <span class="label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                    <span class="value" th:text="${order.customerPhone}">+7 (999) 123-45-67</span>
                </div>
                <div th:if="${order.user != null}" class="info-row-minimal">
                    <span class="label">Email:</span>
                    <span class="value" th:text="${order.user.email}">ivan@mail.com</span>
                </div>
                <div class="info-row-minimal">
                    <span class="label">–¢–∏–ø:</span>
                    <span class="value">
                        <span th:if="${order.user != null}" class="badge-minimal badge-registered">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</span>
                        <span th:if="${order.user == null}" class="badge-minimal badge-guest">–ì–æ—Å—Ç—å</span>
                    </span>
                </div>
            </div>

            <!-- –î–æ—Å—Ç–∞–≤–∫–∞ -->
            <div class="info-card-minimal">
                <h3>üöö –î–æ—Å—Ç–∞–≤–∫–∞</h3>
                <div class="info-row-minimal">
                    <span class="label">–¢–∏–ø:</span>
                    <span class="value" th:text="${order.deliveryType.name() == 'DELIVERY' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑'}"></span>
                </div>
                <div th:if="${order.deliveryAddress != null}" class="info-row-minimal">
                    <span class="label">–ê–¥—Ä–µ—Å:</span>
                    <span class="value" th:text="${order.deliveryAddress}">—É–ª. –ü—É—à–∫–∏–Ω–∞, 10</span>
                </div>
                <div th:if="${order.deliveryTime != null}" class="info-row-minimal">
                    <span class="label">–í—Ä–µ–º—è:</span>
                    <span class="value" th:text="${#temporals.format(order.deliveryTime, 'dd.MM HH:mm')}">27.02 18:30</span>
                </div>
            </div>

            <!-- –û–ø–ª–∞—Ç–∞ -->
            <div class="info-card-minimal">
                <h3>üí≥ –û–ø–ª–∞—Ç–∞</h3>
                <div class="info-row-minimal">
                    <span class="label">–°–ø–æ—Å–æ–±:</span>
                    <span class="value" th:text="${order.paymentMethod.name() == 'CASH' ? '–ù–∞–ª–∏—á–Ω—ã–µ' :
                          order.paymentMethod.name() == 'CARD_ON_DELIVERY' ? '–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' :
                          order.paymentMethod.name() == 'CARD_ONLINE' ? '–ö–∞—Ä—Ç–æ–π –æ–Ω–ª–∞–π–Ω' : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}">
                    </span>
                </div>
                <div class="info-row-minimal">
                    <span class="label">–°—É–º–º–∞:</span>
                    <span class="value" style="font-weight: 600; color: #38a169;"
                          th:text="${#numbers.formatDecimal(order.totalPrice, 0, 0)} + ' ‚ÇΩ'">1 250 ‚ÇΩ</span>
                </div>
            </div>
        </div>

        <!-- –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ -->
        <div class="items-section-minimal">
            <div class="section-title-minimal">
                üìã –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞
            </div>

            <table class="items-table-minimal">
                <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th class="text-center">–ö–æ–ª-–≤–æ</th>
                    <th class="text-right">–¶–µ–Ω–∞</th>
                    <th class="text-right">–°—É–º–º–∞</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${order.items}">
                    <td>
                        <span th:text="${item.dishName}">–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è</span>
                        <span th:if="${item.specialInstructions != null}"
                              style="display: block; font-size: 12px; color: #718096;"
                              th:text="'‚úèÔ∏è ' + ${item.specialInstructions}"></span>
                    </td>
                    <td class="text-center" th:text="${item.quantity}">2</td>
                    <td class="text-right" th:text="${#numbers.formatDecimal(item.priceAtOrder, 0, 0)} + ' ‚ÇΩ'">350 ‚ÇΩ</td>
                    <td class="text-right" style="font-weight: 500;"
                        th:text="${#numbers.formatDecimal(item.totalPrice, 0, 0)} + ' ‚ÇΩ'">700 ‚ÇΩ</td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="3" class="text-right" style="font-weight: 600;">–ò—Ç–æ–≥–æ:</td>
                    <td class="text-right" style="font-weight: 600; color: #38a169;"
                        th:text="${#numbers.formatDecimal(order.totalPrice, 0, 0)} + ' ‚ÇΩ'">1 250 ‚ÇΩ</td>
                </tr>
                </tfoot>
            </table>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
            <div th:if="${order.notes != null and !order.notes.isEmpty()}" class="comment-minimal">
                <strong>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> <span th:text="${order.notes}">–ü–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞ 10 –º–∏–Ω—É—Ç</span>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="action-bar-minimal">
            <a href="/admin/orders" class="btn-minimal btn-minimal-outline">
                ‚Üê –ù–∞–∑–∞–¥
            </a>
            <button type="button" class="btn-minimal btn-minimal-primary"
                    data-bs-toggle="modal" data-bs-target="#statusModal"
                    th:data-order-id="${order.id}" th:data-current-status="${order.status.name()}">
                ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
        </div>
    </div>


    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #<span id="modalOrderId"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="statusForm">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <div class="modal-body">
                        <select name="status" class="form-select" id="modalStatusSelect">
                            <option value="PENDING">–û–∂–∏–¥–∞–µ—Ç</option>
                            <option value="CONFIRMED">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                            <option value="PREPARING">–ì–æ—Ç–æ–≤–∏—Ç—Å—è</option>
                            <option value="READY_FOR_DELIVERY">–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ</option>
                            <option value="ON_THE_WAY">–í –ø—É—Ç–∏</option>
                            <option value="DELIVERED">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                            <option value="COMPLETED">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                            <option value="CANCELLED">–û—Ç–º–µ–Ω–µ–Ω</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</main>
</body>
</html>

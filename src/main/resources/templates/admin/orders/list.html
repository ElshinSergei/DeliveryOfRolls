<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/admin-layout:: html(content=~{::main})}">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</title>
</head>
<body>
<main>
    <div class="admin-container">

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="admin-header">
            <h3>üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h3>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- –ë–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="filters-bar">
            <form method="get" action="/admin/orders" style="display: flex; flex-wrap: wrap; gap: 10px; flex: 1; align-items: center;">
                <!-- –ü–æ–∏—Å–∫ -->
                <div class="filter-item">
                    <i class="bi bi-search"></i>
                    <input type="text" name="search" th:value="${searchQuery}"
                           placeholder="–ü–æ–∏—Å–∫...">
                </div>

                <!-- –°—Ç–∞—Ç—É—Å -->
                <div class="filter-item">
                    <i class="bi bi-tag"></i>
                    <select name="status">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option th:each="s : ${statuses}"
                                th:value="${s.name()}"
                                th:text="${s.name()}"
                                th:selected="${s.name() == selectedStatus}">
                        </option>
                    </select>
                </div>

                <!-- –î–∞—Ç–∞ —Å -->
                <div class="filter-item">
                    <i class="bi bi-calendar"></i>
                    <input type="date" name="dateFrom" th:value="${dateFrom}"
                           placeholder="–û—Ç">
                </div>

                <!-- –î–∞—Ç–∞ –ø–æ -->
                <div class="filter-item">
                    <i class="bi bi-calendar"></i>
                    <input type="date" name="dateTo" th:value="${dateTo}"
                           placeholder="–î–æ">
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="filter-actions">
                    <button type="submit" class="filter-submit">
                        <i class="bi bi-check-lg"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                    <a href="/admin/orders" class="filter-reset">
                        <i class="bi bi-x-lg"></i> –°–±—Ä–æ—Å
                    </a>
                </div>
            </form>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
        <div th:if="${orders == null or orders.isEmpty()}" class="empty-state">
            <h3>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
        <div th:if="${orders != null and not orders.isEmpty()}">
            <table class="table">
                <thead>
                <tr>
                    <th>
                        <a th:href="@{${baseUrl}(page=${orders.number}, size=${orders.size},
                        sort='id,' + ${currentSortField == 'id' ? reverseSortDir : 'asc'},
                        status=${selectedStatus},
                        search=${searchQuery},
                        dateFrom=${dateFrom},
                        dateTo=${dateTo})}"
                           class="sort-header" th:classappend="${currentSortField == 'id'} ? 'active' : ''">
                            ID
                            <span th:if="${currentSortField == 'id'}" class="sort-icon">
                                <span th:if="${currentSortDir == 'asc'}">‚Üë</span>
                                <span th:if="${currentSortDir == 'desc'}">‚Üì</span>
                            </span>
                        </a>
                    </th>
                    <th>
                        <a th:href="@{${baseUrl}(page=${orders.number},
                        size=${orders.size},
                        sort='createdAt,' + ${currentSortField == 'createdAt' ? reverseSortDir : 'desc'},
                        status=${selectedStatus},
                        search=${searchQuery},
                        dateFrom=${dateFrom},
                        dateTo=${dateTo})}"
                           class="sort-header" th:classappend="${currentSortField == 'createdAt'} ? 'active' : ''">
                            –î–∞—Ç–∞
                            <span th:if="${currentSortField == 'createdAt'}" class="sort-icon">
                                <span th:if="${currentSortDir == 'asc'}">‚Üë</span>
                                <span th:if="${currentSortDir == 'desc'}">‚Üì</span>
                            </span>
                        </a>
                    </th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th class="text-center">
                        <a th:href="@{${baseUrl}(page=${orders.number},
                        size=${orders.size},
                        sort='totalPrice,' + ${currentSortField == 'totalPrice' ? reverseSortDir : 'desc'},
                        status=${selectedStatus},
                        search=${searchQuery},
                        dateFrom=${dateFrom},
                        dateTo=${dateTo})}"
                           class="sort-header" th:classappend="${currentSortField == 'totalPrice'} ? 'active' : ''">
                            –°—É–º–º–∞
                            <span th:if="${currentSortField == 'totalPrice'}" class="sort-icon">
                                <span th:if="${currentSortDir == 'asc'}">‚Üë</span>
                                <span th:if="${currentSortDir == 'desc'}">‚Üì</span>
                            </span>
                        </a>
                    </th>
                    <th class="text-center">–¢–∏–ø</th>
                    <th class="text-center">–û–ø–ª–∞—Ç–∞</th>
                    <th class="text-center">–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody id="ordersTableBody">
                <tr th:each="order : ${orders.content}" th:id="|order-${order.id}|">
                    <td>
                        <strong>#[[${order.id}]]</strong>
                    </td>
                    <td>
                        <span th:text="${#temporals.format(order.createdAt, 'dd.MM.yyyy HH:mm')}">
                            12.02.2026 15:30
                        </span>
                    </td>
                    <td>
                        <span th:text="${order.customerName}">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</span>
                        <span th:if="${order.hasUser}" class="text-muted d-block">
                            <i class="bi bi-person-check"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
                        </span>
                    </td>
                    <td th:text="${order.customerPhone}">+7 (999) 123-45-67</td>
                    <td class="text-center">
                        <span class="price" th:text="${#numbers.formatDecimal(order.totalPrice, 0, 0)} + ' ‚ÇΩ'">
                            1250 ‚ÇΩ
                        </span>
                    </td>
                    <td class="text-center">
                        <th:block th:switch="${order.deliveryType}">
                            <span th:case="'DELIVERY'" class="badge-info">–î–æ—Å—Ç–∞–≤–∫–∞</span>
                            <span th:case="'PICKUP'" class="badge-secondary">–°–∞–º–æ–≤—ã–≤–æ–∑</span>
                        </th:block>
                    </td>
                    <td class="text-center">
                        <th:block th:switch="${order.paymentMethod}">
                            <span th:case="'CASH'" class="badge-warning">–ù–∞–ª–∏—á–Ω—ã–µ</span>
                            <span th:case="'CARD_ON_DELIVERY'" class="badge-success">–ö–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</span>
                            <span th:case="'CARD_ONLINE'" class="badge-primary">–û–Ω–ª–∞–π–Ω</span>
                        </th:block>
                    </td>
                    <td class="text-center">
                        <th:block th:switch="${order.status}">
                            <span th:case="'PENDING'" class="status-pending">–û–∂–∏–¥–∞–µ—Ç</span>
                            <span th:case="'CONFIRMED'" class="status-confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                            <span th:case="'PREPARING'" class="status-preparing">–ì–æ—Ç–æ–≤–∏—Ç—Å—è</span>
                            <span th:case="'READY_FOR_DELIVERY'" class="status-ready">–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ</span>
                            <span th:case="'ON_THE_WAY'" class="status-ontheway">–í –ø—É—Ç–∏</span>
                            <span th:case="'DELIVERED'" class="status-delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</span>
                            <span th:case="'COMPLETED'" class="status-completed">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                            <span th:case="'CANCELLED'" class="status-cancelled">–û—Ç–º–µ–Ω–µ–Ω</span>
                        </th:block>
                    </td>
                    <td>
                        <div class="btn-group">
                            <a th:href="@{/admin/orders/{id}(id=${order.id})}"
                               class="btn-view" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                <i class="bi bi-eye"></i>
                            </a>
                            <button type="button"
                                    class="btn-edit"
                                    data-bs-toggle="modal"
                                    data-bs-target="#statusModal"
                                    th:data-order-id="${order.id}"
                                    th:data-current-status="${order.status}"
                                    title="–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div th:insert="~{fragments/pagination :: pagination(${orders}, ${baseUrl},
            ${selectedStatus}, ${searchQuery}, ${dateFrom}, ${dateTo})}">
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
            <div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #<span id="modalOrderId"></span></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form id="statusForm">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <div class="modal-body">
                                <select name="status" class="form-select" id="modalStatusSelect">
                                    <option value="PENDING">–û–∂–∏–¥–∞–µ—Ç</option>
                                    <option value="CONFIRMED">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                                    <option value="PREPARING">–ì–æ—Ç–æ–≤–∏—Ç—Å—è</option>
                                    <option value="READY_FOR_DELIVERY">–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ</option>
                                    <option value="ON_THE_WAY">–í –ø—É—Ç–∏</option>
                                    <option value="DELIVERED">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                                    <option value="COMPLETED">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                    <option value="CANCELLED">–û—Ç–º–µ–Ω–µ–Ω</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

</main>
</body>
</html>